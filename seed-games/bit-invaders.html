<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#09090b;overflow:hidden;display:flex;align-items:center;justify-content:center;height:100vh;font-family:'JetBrains Mono',monospace}
canvas{display:block}
</style>
</head>
<body>
<canvas id="c"></canvas>
<script>
const W=640,H=480,C=document.getElementById('c'),X=C.getContext('2d');
let scale=1;function resize(){const r=Math.min(innerWidth/W,innerHeight/H);scale=r;C.width=W;C.height=H;C.style.width=W*r+'px';C.style.height=H*r+'px'}
resize();addEventListener('resize',resize);

const LABELS=['NOISE','SPAM','FUD','HYPE','BIAS','LEAK','SCAM','BAIT'];
let state='menu',px=W/2,score=0,lives=3,wave=1,invaders=[],bullets=[],particles=[],frame=0,invDir=1,invSpeed=0.5,lastShot=0,lastEnemyShot=0,shake=0;
const keys={};

addEventListener('keydown',e=>{keys[e.key]=true;
if(state==='menu'&&(e.key===' '||e.key==='Enter')){state='playing';resetGame()}
if(state==='gameover'&&(e.key===' '||e.key==='Enter')){state='playing';resetGame()}
if(state==='waveComplete'&&(e.key===' '||e.key==='Enter')){nextWave();state='playing'}
if(e.key==='Escape')if(state==='playing')state='paused';else if(state==='paused')state='playing'});
addEventListener('keyup',e=>{keys[e.key]=false});

let touchX=null,touchActive=false;
C.addEventListener('touchstart',e=>{e.preventDefault();touchActive=true;const t=e.touches[0];touchX=(t.clientX-C.getBoundingClientRect().left)/scale;
if(state==='menu'||state==='gameover'){state='playing';resetGame()}
if(state==='waveComplete'){nextWave();state='playing'}},{passive:false});
C.addEventListener('touchmove',e=>{e.preventDefault();const t=e.touches[0];touchX=(t.clientX-C.getBoundingClientRect().left)/scale},{passive:false});
C.addEventListener('touchend',()=>{touchActive=false;touchX=null});

function resetGame(){px=W/2;score=0;lives=3;wave=1;bullets=[];particles=[];frame=0;shake=0;spawnWave()}

function spawnWave(){
invaders=[];bullets=[];
const rows=Math.min(6,3+Math.floor((wave-1)/2));
const cols=Math.min(12,8+Math.floor((wave-1)/3));
invSpeed=0.5+(wave-1)*0.2;invDir=1;
const gapX=45,gapY=35,startX=(W-cols*gapX)/2+20,startY=50;
for(let r=0;r<rows;r++)for(let c=0;c<cols;c++){
invaders.push({x:startX+c*gapX,y:startY+r*gapY,w:30,h:20,alive:true,row:r,label:LABELS[r%LABELS.length],pts:(rows-r)*10})
}}

function nextWave(){wave++;spawnWave()}

function addP(x,y,c,n){for(let i=0;i<n;i++)particles.push({x,y,vx:(Math.random()-0.5)*6,vy:(Math.random()-0.5)*6,life:15+Math.random()*15,color:c,size:2+Math.random()*2})}

function update(){
if(state!=='playing')return;
frame++;

// Move player
const spd=5;
if(keys['ArrowLeft']||keys['a'])px-=spd;
if(keys['ArrowRight']||keys['d'])px+=spd;
if(touchX!==null)px+=(touchX-px)*0.12;
px=Math.max(20,Math.min(W-20,px));

// Player shoot
if((keys[' ']||keys['ArrowUp']||touchActive)&&frame-lastShot>12){
bullets.push({x:px,y:H-50,vy:-7,player:true});lastShot=frame}

// Move invaders
let hitEdge=false;
const alive=invaders.filter(v=>v.alive);
for(const v of alive){v.x+=invSpeed*invDir;if(v.x<10||v.x+v.w>W-10)hitEdge=true}
if(hitEdge){invDir*=-1;for(const v of alive)v.y+=15}

// Check invaders reached bottom
for(const v of alive){if(v.y+v.h>H-70){state='gameover';window.parent.postMessage({type:'SCORE',score},'*');return}}

// Enemy shoot
const fireRate=Math.max(30,90-wave*5);
if(frame-lastEnemyShot>fireRate){
// Pick random bottom invader per column
const cols=new Map();
for(const v of alive){const c=Math.round(v.x/45);if(!cols.has(c)||v.y>cols.get(c).y)cols.set(c,v)}
const shooters=[...cols.values()];
if(shooters.length>0){const s=shooters[Math.floor(Math.random()*shooters.length)];
bullets.push({x:s.x+s.w/2,y:s.y+s.h,vy:3+wave*0.3,player:false})}
lastEnemyShot=frame;
}

// Update bullets
for(let i=bullets.length-1;i>=0;i--){
const b=bullets[i];b.y+=b.vy;
if(b.y<-10||b.y>H+10){bullets.splice(i,1);continue}

if(b.player){
// Hit invader
for(const v of alive){
if(v.alive&&b.x>v.x&&b.x<v.x+v.w&&b.y>v.y&&b.y<v.y+v.h){
v.alive=false;score+=v.pts;addP(v.x+v.w/2,v.y+v.h/2,'#00ff41',10);bullets.splice(i,1);break}
}}else{
// Hit player
if(Math.abs(b.x-px)<15&&b.y>H-55&&b.y<H-25){
lives--;shake=8;addP(px,H-40,'#ff3333',12);bullets.splice(i,1);
if(lives<=0){state='gameover';window.parent.postMessage({type:'SCORE',score},'*')}
}}}

// Wave clear
if(alive.length===0&&state==='playing')state='waveComplete';

// Particles
for(let i=particles.length-1;i>=0;i--){const p=particles[i];p.x+=p.vx;p.y+=p.vy;p.life--;if(p.life<=0)particles.splice(i,1)}
if(shake>0)shake*=0.85;
}

function draw(){
X.save();
if(shake>0)X.translate(Math.random()*shake-shake/2,Math.random()*shake-shake/2);

X.fillStyle='#09090b';X.fillRect(0,0,W,H);
X.strokeStyle='rgba(0,255,65,0.03)';X.lineWidth=1;
for(let i=0;i<W;i+=40){X.beginPath();X.moveTo(i,0);X.lineTo(i,H);X.stroke()}
for(let i=0;i<H;i+=40){X.beginPath();X.moveTo(0,i);X.lineTo(W,i);X.stroke()}

if(state==='menu'){
X.textAlign='center';X.fillStyle='#00ff41';X.font='bold 32px monospace';X.fillText('BIT INVADERS',W/2,H/2-50);
X.font='12px monospace';X.fillStyle='#a1a1aa';X.fillText('Shoot the noise. Defend the signal.',W/2,H/2-10);
X.fillStyle='#00ff41';X.fillText('[← →] Move  [SPACE] Shoot',W/2,H/2+20);
X.fillText('[ENTER / TAP] to start',W/2,H/2+50);
X.restore();return}

if(state==='paused'){
X.fillStyle='rgba(0,0,0,0.7)';X.fillRect(0,0,W,H);
X.fillStyle='#00ff41';X.font='bold 24px monospace';X.textAlign='center';X.fillText('PAUSED',W/2,H/2);
X.restore();return}

// Invaders
X.font='bold 8px monospace';X.textAlign='center';
const colors=['#ff3333','#ff6633','#3388ff','#8833ff','#00ff41','#ffaa00'];
for(const v of invaders){if(!v.alive)continue;
const c=colors[v.row%colors.length];
X.fillStyle=c+'30';X.fillRect(v.x,v.y,v.w,v.h);
X.strokeStyle=c+'80';X.strokeRect(v.x,v.y,v.w,v.h);
X.fillStyle=c;X.fillText(v.label,v.x+v.w/2,v.y+v.h/2+3);
}

// Bullets
for(const b of bullets){
X.fillStyle=b.player?'#00ff41':'#ff3333';
X.fillRect(b.x-2,b.y-4,4,8);
X.shadowColor=b.player?'#00ff41':'#ff3333';X.shadowBlur=6;
X.fillRect(b.x-2,b.y-4,4,8);X.shadowBlur=0;
}

// Player
X.fillStyle='#00ff41';
X.beginPath();X.moveTo(px,H-55);X.lineTo(px-15,H-30);X.lineTo(px+15,H-30);X.closePath();X.fill();
X.fillRect(px-15,H-30,30,5);
X.shadowColor='#00ff41';X.shadowBlur=8;
X.fillStyle='#00ff4140';X.beginPath();X.moveTo(px,H-55);X.lineTo(px-15,H-30);X.lineTo(px+15,H-30);X.closePath();X.fill();
X.shadowBlur=0;

// Particles
for(const p of particles){X.globalAlpha=p.life/30;X.fillStyle=p.color;X.fillRect(p.x,p.y,p.size,p.size)}
X.globalAlpha=1;

// HUD
X.textAlign='left';X.font='bold 12px monospace';X.fillStyle='#00ff41';
X.fillText('SCORE: '+score,10,25);X.fillText('WAVE: '+wave,10,42);
X.fillStyle='#ff3333';X.textAlign='right';X.fillText('♥'.repeat(lives),W-10,25);

if(state==='waveComplete'){
X.fillStyle='rgba(0,0,0,0.7)';X.fillRect(0,0,W,H);
X.textAlign='center';X.fillStyle='#00ff41';X.font='bold 24px monospace';X.fillText('WAVE '+wave+' CLEAR',W/2,H/2-20);
X.font='12px monospace';X.fillStyle='#a1a1aa';X.fillText('[ENTER / TAP] for next wave',W/2,H/2+20);
}

if(state==='gameover'){
X.fillStyle='rgba(0,0,0,0.8)';X.fillRect(0,0,W,H);
X.textAlign='center';X.fillStyle='#ff3333';X.font='bold 28px monospace';X.fillText('GAME OVER',W/2,H/2-40);
X.fillStyle='#00ff41';X.font='bold 18px monospace';X.fillText('SCORE: '+score,W/2,H/2);
X.font='12px monospace';X.fillStyle='#a1a1aa';X.fillText('Wave: '+wave,W/2,H/2+25);
X.fillStyle='#00ff41';X.fillText('[ENTER / TAP] to restart',W/2,H/2+60);
}

X.restore();
}

function loop(){update();draw();requestAnimationFrame(loop)}
loop();
</script>
</body>
</html>
